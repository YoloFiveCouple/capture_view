<!DOCTYPE html>
<html>

<head>
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@4.x/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
</head>

<body>
    <div id="app">
        <v-app>
            <v-main>
                <v-container>
                    <v-row>
                        <v-col cols="12" sm="5">
                            <v-row>
                                <h1>ラズパイストリーミング映像</h1>
                                <img style="-webkit-user-select: none;margin: auto;background-color: hsl(0, 2%, 12%);" height="400px" width="600px" src="http://raspberrypi.local:8081/">
                            </v-row>
                            <v-row>
                                キャプチャ総数 : {{motion_data.length}}
                            </v-row>
                        </v-col>
                        <v-col cols="12" sm="7">
                            <h1>キャプチャされた画像</h1>
                            <template>
                                <v-data-table 
                                    dense
                                    :headers="motion_header" 
                                    :items="motion_data" 
                                    :items-per-page="15" 
                                    item-key="filename"
                                    class="elevation-1" 
                                    :search="search"
                                    :custom-filter="filterOnlyCapsText"
                                    >
                                    <template v-slot:top>
                                        <v-text-field
                                            v-model="search"
                                            label="Search(ファイル名で検索 例えば、'09250744など')"
                                            class="mx-4"
                                        >
                                        </v-text-field>
                                    </template>
                                    <template v-slot:item.img="{item}">
                                        <img v-bind:src="'data:Image/png;base64,'+ item.img" height="50px" width="50px" />
                                    </template>
                                </v-data-table>
                            </template>
                        </v-col>
                    </v-row>
                </v-container>
            </v-main>
        </v-app>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        new Vue({
            el: '#app',
            vuetify: new Vuetify(),
            data: function () {
                return {
                    search:'',
                    motion_header: [
                        { text: 'id', value: 'id' },
                        { text: 'img', value: 'img' },
                        { text: 'file_date', value: 'file_date' },
                        { text: 'file_time', value: 'file_time' },
                        { text: 'filename', value: 'file_name' }
                    ],
                    motion_data: [
                        // データは以下のような形式
                        // {
                        //     id:'1',
                        //     filename:'A.jpeg',
                        //     img:'base64だよ'
                        // },
                    ],
                }
            },
            methods: {
                get_picture: function () {
                    axios.get("http://localhost:5000/api/pictures")
                        .then(function (res) {
                            console.log(res)
                        });
                },
                filterOnlyCapsText : function(value, search, item) {
                    return value != null &&
                            search != null &&
                            value.toString().toLocaleUpperCase().indexOf(search) !== -1
                }
            },
            created: function () {
                var vm = this
                axios.get("http://192.168.0.100:5000/api/pictures")
                    .then(function (res) {
                        console.log(res)
                        console.log(res.data)
                        console.log(res.data.fileList)
                        vm.motion_data = []
                        vm.motion_data = res.data.fileList
                    });
            },
        })
    </script>
</body>

</html>